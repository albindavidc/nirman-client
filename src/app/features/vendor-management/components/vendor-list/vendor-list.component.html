<div class="vendor-management-page" @fadeInUp>
  <!-- Header -->
  <header class="page-header">
    <div class="header-content">
      <div>
        <h1 class="page-title">Vendor Management</h1>
        <p class="page-subtitle">Review and approve vendor applications</p>
      </div>
      <button
        mat-flat-button
        color="primary"
        class="add-btn"
        (click)="openVendorModal()"
      >
        <mat-icon>add</mat-icon>
        Add Vendor
      </button>
    </div>
  </header>

  <!-- Stats Cards -->
  @if (stats$ | async; as stats) {
  <div class="stats-grid" @staggerIn>
    @for (card of statCards; track card.label) {
    <div class="stat-card" [class]="card.color">
      <div class="stat-icon">
        <mat-icon>{{ card.icon }}</mat-icon>
      </div>
      <div class="stat-content">
        <div class="stat-value">{{ card.getValue(stats) }}</div>
        <div class="stat-label">{{ card.label }}</div>
      </div>
    </div>
    }
  </div>
  }

  <div class="vendor-list-card">
    <div class="card-header">
      <h2>All Vendors</h2>
      <div class="header-actions">
        <mat-form-field
          appearance="outline"
          class="search-field"
          subscriptSizing="dynamic"
          (keyup)="onSearchChange($event)"
        >
          <mat-icon matPrefix>search</mat-icon>
          <input matInput placeholder="Search vendors..." />
        </mat-form-field>

        <mat-form-field
          appearance="outline"
          class="filter-field"
          subscriptSizing="dynamic"
        >
          <mat-select
            [formControl]="statusFilter"
            placeholder="Filter by Status"
          >
            <mat-option value="">All Statuses</mat-option>
            <mat-option value="approved">Approved</mat-option>
            <mat-option value="pending">Pending</mat-option>
            <mat-option value="rejected">Rejected</mat-option>
            <mat-option value="blacklisted">Blacklisted</mat-option>
          </mat-select>
        </mat-form-field>
      </div>
    </div>

    @if (error$ | async; as error) {
    <div class="error-container">
      <mat-icon>error_outline</mat-icon>
      <span>{{ error }}</span>
    </div>
    } @else {
    <app-table
      [data]="(vendors$ | async) || []"
      [columns]="columns"
      [total]="(total$ | async) || 0"
      [isLoading]="(isLoading$ | async) || false"
      [pageSize]="pageSize"
      [pageSizeOptions]="pageSizeOptions"
      [columnTemplates]="{
        vendor: vendorTemplate,
        contact: contactTemplate,
        category: categoryTemplate,
        status: statusTemplate,
        actions: actionsTemplate
      }"
      (pageChange)="onPageChange($event)"
    >
    </app-table>

    <!-- Templates -->
    <ng-template #vendorTemplate let-row>
      <div class="vendor-info">
        <div class="vendor-avatar">
          {{ row.companyName?.charAt(0) | uppercase }}
        </div>
        <div class="vendor-details">
          <span class="vendor-name">{{ row.companyName }}</span>
          <span class="vendor-code">{{ getVendorCode(row) }}</span>
        </div>
      </div>
    </ng-template>

    <ng-template #contactTemplate let-row>
      <div class="contact-info">
        <span class="contact-name">{{ row.contactName || "N/A" }}</span>
        <span class="contact-email">{{ row.contactEmail || "N/A" }}</span>
      </div>
    </ng-template>

    <ng-template #categoryTemplate let-row>
      <span
        class="category-badge"
        >{{ row.productsServices?.[0] || 'General' }}</span
      >
    </ng-template>

    <ng-template #statusTemplate let-row>
      <span class="status-badge" [class]="getStatusClass(row.vendorStatus)">
        <mat-icon class="status-icon">{{
          getStatusIcon(row.vendorStatus)
        }}</mat-icon>
        {{ row.vendorStatus | titlecase }}
      </span>
    </ng-template>

    <ng-template #actionsTemplate let-row>
      <div class="action-buttons">
        @if (row.vendorStatus === 'pending') {
        <button
          mat-flat-button
          class="approve-btn"
          (click)="approveVendor(row)"
        >
          <mat-icon>check_circle</mat-icon>
          Approve
        </button>
        <button
          mat-stroked-button
          class="reject-btn"
          (click)="rejectVendor(row)"
        >
          <mat-icon>cancel</mat-icon>
          Reject
        </button>
        } @if (row.vendorStatus === 'approved') {
        <button
          mat-stroked-button
          class="blacklist-btn"
          (click)="blacklistVendor(row)"
          matTooltip="Blacklist vendor"
        >
          <mat-icon>block</mat-icon>
          Blacklist
        </button>
        } @if (row.vendorStatus === 'blacklisted') {
        <button
          mat-stroked-button
          class="unblacklist-btn"
          (click)="unblacklistVendor(row)"
          matTooltip="Unblacklist vendor"
        >
          <mat-icon>published_with_changes</mat-icon>
          Unblacklist
        </button>
        }
        <button
          mat-icon-button
          class="edit-btn"
          (click)="openVendorModal(row)"
          matTooltip="Edit vendor"
        >
          <mat-icon>edit</mat-icon>
        </button>
      </div>
    </ng-template>
    }
  </div>
</div>
